<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="mbK83M8fq9oKpHxh7VGEx7oKdTj2XSyJ6unZ3MoB0Lk"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>reporting concerns on data leakage | Joren Brunekreef</title> <meta name="author" content="Joren Brunekreef"> <meta name="description" content="Joren Brunekreef's personal homepage. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A4%96&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jorenb.github.io/blog/2024/data-leakage/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "reporting concerns on data leakage",
      "description": "",
      "published": "April 30, 2024",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Joren </span>Brunekreef</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/recommended/">recommended</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>reporting concerns on data leakage</h1> <p></p> </d-title><d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#how-it-all-started">how it all started</a></div> <div><a href="#splitting-data">splitting data</a></div> <div><a href="#following-up">following up</a></div> <div><a href="#making-the-case">making the case</a></div> <div><a href="#wrapping-up">wrapping up</a></div> </nav> </d-contents> <p>Today, the <a href="https://link.springer.com/journal/10278" rel="external nofollow noopener" target="_blank">Journal of Imaging Informatics in Medicine</a> (formerly the Journal of Digital Imaging) published my <a href="https://link.springer.com/article/10.1007/s10278-024-01129-3" rel="external nofollow noopener" target="_blank">Letter to the Editor</a> (<a href="/assets/pdf/2024-04-30-data-leakage/letter-to-the-editor.pdf">preprint</a>) in which I raise concerns about data leakage in <a href="https://link.springer.com/article/10.1007/s10278-018-0144-1" rel="external nofollow noopener" target="_blank">this paper</a><d-cite key="ha2019prior"></d-cite> on predicting chemotherapy response from MRI data. Getting to this point was a valuable learning experience for me, and I thought it would be interesting to share some of my findings here.</p> <h1 id="how-it-all-started">how it all started</h1> <p>In the summer of 2023, I collaborated with several others on a review<d-cite key="logullo2024ai"></d-cite> about applications of AI for magnetic resonance imaging (MRI) of the breast. One subtopic that we highlighted was <em>treatment response prediction</em> in the context of breast cancer. The goal here is to predict the likelihood that a patient will respond well to a specific cancer treatment strategy, purely based on data collected <strong>before</strong> the treatment is started. For breast cancer, most research thus far has focused on predicting the outcome of <em>neoadjuvant chemotherapy</em> (NAC). As per the scope of our review, we restricted attention to papers where the data used to make these predictions included pre-treatment breast MRI scans. The hypothesis of such studies is that some MR imaging features of the breast and/or tumor tissue (potentially augmented with some clinical variables, such as patient age and the presence of a high-risk mutation) correlate with the likelihood to respond to treatment. Usually, “response” is defined as <em>pathologic complete response</em>, which is determined post-treatment by inspecting tissue samples for the presence of residual tumor cells.</p> <div class="row justify-content-center"> <div class="col-5"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/axial-duke-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/axial-duke-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/axial-duke-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/axial-duke.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption">A 2D slice of a breast MRI scan, taken from the public Duke breast MRI dataset.<d-cite key="saha2018machine"></d-cite> </div> <p>It’s not unreasonable to expect that such correlations may exist, even though it may be tricky for a human to spot the relevant features. Therefore, people have been trying to throw machine learning methods at this problem: given a set of pre-treatment MRI scans of patients for whom treatment outcome is known, one can attempt to train a model to classify the patients as either responders or non-responders to the chosen treatment. If the resulting model attains good classification performance on MRI scans of patients <strong>not included in the training set</strong>, we have some evidence that the model has indeed learned to recognize some of the salient features that are predictive of treatment response.</p> <p>However, breast cancer is a complex disease and the effectiveness of a specific treatment strategy depends on a large array of factors. It would therefore be highly surprising if a single pre-treatment MRI scan would provide sufficient information for reliably predicting pathologic complete response. And indeed, most studies find that imaging features only correlate very weakly — if at all — with treatment response. For example, Joo et al.<d-cite key="joo2021multimodal"></d-cite> report the following result of their attempt to train a convolutional neural network (CNN) to predict pCR from pre-treatment MRI data:</p> <div class="row justify-content-center"> <div class="col-10"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/roc-joo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/roc-joo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/roc-joo-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/roc-joo.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>These diagrams show the receiver-operating characteristic (ROC) curve of the evaluation of their model on validation data (n=107 patients) that was unseen during training (on n=429 patients). Clinical variables were included for the leftmost diagram, whereas the rightmost diagram os for imaging data alone (T1, T2 refer to different types of image weighting in the MRI acquisition protocol). The ROC curve shows how the true positive rate and false positive rate vary as one changes the <em>operating point</em> of the classifier: the model itself outputs a “probability” that a patient will respond to treatment, and the operating point is the threshold at which we binarize the prediction. A low threshold eagerly classifies patients as responders, with a higher likelihood of including false positives. Raising the threshold will lower the chance of finding false positives, but some true positives will accordingly be missed.</p> <p>The overall performance of such a classifier model is often reported as the Area Under the ROC curve (AUROC, or simply AUC), and the AUCs for the curves shown above can be found in the figure legend. A classifier with an AUC of 1.0 is perfect, whereas a completely random classifier has an expected AUC of 0.5, corresponding to the dotted diagonal.<d-footnote>The legend here uses "luck" to indicate the expected (diagonal) ROC curve for a random classifier. Actually, I think the term "luck" is not really appropriate. Being lucky implies that you're doing something right — the diagonal line corresponds to the scenario you'd expect to occur if you're guessing blindly.</d-footnote> Although the AUC is an aggregate metric that does not tell the full story, AUCs above 0.8 are generally considered “acceptable”.<d-cite key="nahm2022receiver"></d-cite> The figure presented above shows that none of the image-only models reach this level. The image+clinical models both have AUCs above 0.8, but apparently the clinical-only model already reaches an AUC of 0.827. Adding the image data into the mix just leads to a small increase in performance. I should also mention that of all the works found during our literature search, this study had by far the largest dataset, consisting of 536 patients.</p> <p>Therefore, I was quite surprised when another study<d-cite key="ha2019prior"></d-cite>, using an image-only dataset of just 141 patients, presented the following results for the CNN prediction model they constructed:</p> <div class="row justify-content-center"> <div class="col-8"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/roc-ha-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/roc-ha-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/roc-ha-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/roc-ha.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The blue graph is the ROC curve after averaging over a five-fold crossvalidation procedure. Apparently, their model attains AUCs of 0.98 on five different random 80/20 train/validation splits of their data. This would be a <em>spectacular</em> result, implying that their model — trained on just 113 patients — is capable of predicting treatment response with near-perfect accuracy from pre-treatment MRI scans alone.</p> <p>However, all this seemed way too good to be true, and I decided to take a closer look to see what could be going on under the hood.</p> <h1 id="splitting-data">splitting data</h1> <p>The MRI scans used for this study are 3D volumes. There are multiple ways in which such scans can be fed to a CNN. A straightforward choice is to use a network with 3D convolutional filters that takes 3D volumes as input. Another option is to view a 3D scan as a collection of 2D slices, and to feed these slices to a 2D CNN. This second approach typically requires much less GPU memory and training time, and is therefore the method of choice if resources are limited. Since the paper under consideration was published in 2018, it is not surprising that they indeed make use of the 2D approach, as explained in their Methods section. The authors furthermore mention that they restrict attention to slices containing a certain minimum amount of visible tumor tissue, after which they are left with a total of 3107 two-dimensional slices of 141 patients, corresponding to 22 slices per patient on average. The slices are then cropped to 64x64 pixels centered around the tumor.<d-footnote>It's not entirely clear to me from the text what the physical dimensions of the crops are, but it seems they are slightly non-uniform throughout the full dataset.</d-footnote> The paper presents several examples of the cropped images, one of which is shown here:</p> <div class="row justify-content-center"> <div class="col-5"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/ha-slice-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/ha-slice-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/ha-slice-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/ha-slice.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Each patient is labeled as having undergone either no response, partial response, or full response to neoadjuvant chemotherapy. All slices of a given patient are assigned the same three-way response label. The CNN is then trained to predict this response label based on a 2D MRI slice like the one shown above. As always, a <em>test set</em> is held back during training to validate the model’s performance after training has completed. However, finding good performance on such a single (random) choice of held-back data may simply be due to luck. The authors describe using five-fold crossvalidation to mitigate this issue, but it seems they actually employ a mix of nested and non-nested crossvalidation where only the inner loop is performed. In the end, five different models are evaluated on a single held-out test set consisting of 20% of the available MRI slices. The five ROC curves in the figure shown above report how well the model performed at discriminating one of the outcome labels from the other two.</p> <p>Even though it’s generally better to validate models on several test sets in a proper crossvalidation procedure, it’s quite unlikely that the use of a single evaluation set can explain the AUC of 0.98 as a fluke. The 0.98 appears for all five models, and these were trained on (partially) different datasets. Furthermore, 20% of 3107 is still 621 slices, so the odds of getting an AUC of 0.98 by pure luck are not great.</p> <p><ins>That said, I do suspect that the explanation can be found in the way this test set was constructed.</ins></p> <p>The correct approach in this scenario would be to randomly assign 80% (n=113) of the patients to the train set and 20% (n=28) of the patients to the test set. The actual data points in the train set would then be all MRI slices belonging to those 113 “training patients”. All slices belonging to the 28 “testing patients” should be held back for evaluation after training has completed.</p> <p><ins>However, my guess is that the authors accidentally split on the <em>slice</em> level, rather than on the <em>patient</em> level.</ins></p> <p>Suppose one simply shuffles all these 3107 slices and subsequently assigns the first 80% to a train set and the remaining 20% to a test set. Considering that there are on average 22 slices per patient, <strong>it is then extremely likely that different MRI slices of the same patient end up in both the train and test set.</strong> This would imply the setup is suffering from <strong>data leakage</strong>: even though there is <em>technically</em> no overlap between the train and test data, one should take into account that nearby slices of the same patient can look highly similar. As mentioned in the MRI Methods section of the paper, the slice thickness of the scans was 2-3mm, so that neighboring slices show nearly the same parts of the patient’s anatomy. To see how similar such neighboring slices can be, consider the following sample taken from the public Duke Breast MRI dataset:<d-cite key="saha2018machine"></d-cite></p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-0-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-0-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-0-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/duke-slice-0.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-1-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/duke-slice-1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/duke-slice-2-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/duke-slice-2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It’s easy to imagine what could happen in this case: instead of discovering useful imaging features that correlate with treatment response, the model can simply find a shortcut by “memorizing” what a patient’s anatomy approximately looks like, along with that patient’s response label. When a similar MRI slice is encountered in the “held-back” test set, the model can spit out the response label of the corresponding patient, without actually having learned any <em>generalizable</em> features. Neural networks are notoriously great at memorizing their training data, so finding this shortcut would be a piece of cake for the CNN they used.</p> <p>Note that there is no hard evidence that this “leaky splitting” is indeed what occurred. However, the methods section is vague on the details of the split:</p> <blockquote> <p>The data was divided into 80% validation and 20% test. The validation test set was then divided into fivefold, and fivefold cross-validation was performed. Training from scratch without pretrained weights was done over 100 epochs using adam optimizer with nesterov momentum at an initial learning rate of 0.002. Each of the five models was tested against the 20% hold out data to obtain sensitivity, specificity, and accuracy. Receiver operator curves were also calculated for each of the five models.</p> </blockquote> <p>In any case, there is no mention of a patient-level split, so we should at least consider the accidental “leaky split” as a <em>potential</em> explanation of the absurdly high AUC values.</p> <h1 id="following-up">following up</h1> <p>Now, there’s no use following up on everything that’s (potentially) <a href="https://xkcd.com/386/" rel="external nofollow noopener" target="_blank">wrong on the internet</a>. However, as of 30 April 2024, this paper has been cited 125 times (according to Google Scholar), making it something of a standard reference in the field. If these spectacular results could indeed be attributed to data leakage, they could therefore set an unrealistic benchmark for follow-up studies. Researchers might be misled into thinking that such performance levels are in principle attainable for similar prediction tasks, or form the wrong expectations for integrating models like these into a clinical decision-making workflow. I discussed some of these considerations with a few colleagues (most extensively with Eric Marcus), and all agreed that this issue <em>did</em> warrant some kind of follow-up.</p> <p>Since the paper itself did not provide sufficient detail to resolve the matter, I first posted a <a href="https://pubpeer.com/publications/1D7AA16B89403EFEF30094E66C3566" rel="external nofollow noopener" target="_blank">comment on PubPeer</a> back in September, 2023. The website indicated that the first author’s email address is known, so they should have received a notification about my comment. However, no reply was posted after several weeks of waiting.</p> <p>The first author is also listed as corresponding author, so in late November I sent him an email to ask for the details of their data splitting procedure, and I explained why I was concerned that something may have gone wrong there. Unfortunately, I did not receive a reply in the two weeks that followed. I then sent a follow-up email, asking whether he could get back to me on this. I also indicated that I was considering to reach out to the journal about the matter:</p> <blockquote> <p>I would like to once more draw your attention to this message. I understand you are busy and you may miss some emails every now and again, but I think this is an important issue and I would very much like to verify whether I can attain similar performance — if it can be reproduced, it would serve as a great benchmark. If you might miss this message again, I will contact the Journal of Digital Imaging later this week to ask whether they can help me get in touch with you or your team, or to provide the raw data so that I can run my own experiments.</p> </blockquote> <p>However, this again did not result in a reply. On December 11, 2023, I therefore emailed<d-footnote>I based my email off <a href="https://scienceintegritydigest.com/2019/07/16/how-to-report-misconduct-to-a-journal/" rel="external nofollow noopener" target="_blank">this template</a> provided by <a href="https://twitter.com/MicrobiomDigest" rel="external nofollow noopener" target="_blank">Elisabeth Bik</a>.</d-footnote> the editors of the Journal of Digital Imaging to explain my concerns with the paper, and why I felt this matter was worth looking into. The editor-in-chief soon replied that the board would investigate. Some time later, they informed me that the paper would be left as is, but that I would be welcome to submit an official letter to the editor to voice my concerns.</p> <h1 id="making-the-case">making the case</h1> <p>Since I hadn’t ever written an editorial letter before, I asked around for some advice. One of the first things my PI (<a href="https://www.nki.nl/research/find-a-researcher/groupleaders/jan-jakob-sonke/" rel="external nofollow noopener" target="_blank">prof. Jan-Jakob Sonke</a>) advised me to do was to set up a similar experiment to try and reproduce the paper’s results for a similar prediction problem. The public Duke Breast MRI dataset<d-cite key="saha2018machine"></d-cite> contains breast MRI scans of 922 invasive breast cancer patients, along with tumor bounding boxes and a data sheet of each patient’s metadata. I set up some filtering criteria (e.g. known pCR, presence of a pre-treatment scan), after which I was left with 282 patients. Of these patients, 22% (n=61) had pathologic complete response to treatment, and 78% (n=221) had residual disease. For these patients, I collected all 2D MRI slices that overlapped with the tumor bounding boxes (note this approach is slightly different from the one followed in the paper), resulting in a set of 9332 slices.</p> <p>Subsequently, I made two random 80/20 train/test splits of the slices: one “proper” split on the <em>patient</em> level and one “leaky” split on the <em>slice</em> level. I then trained a convolutional neural network (more specifically, a ResNet18) on each of the train splits, and subsequently evaluated the models on the corresponding test split. This resulted in the following ROC curves:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-proper-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-proper-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-proper-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/roc_curve-proper.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-leaky-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-leaky-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2024-04-30-data-leakage/roc_curve-leaky-1400.webp"></source> <img src="/assets/img/2024-04-30-data-leakage/roc_curve-leaky.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>That’s quite a big difference. It may seem surprising that the “properly” trained/evaluated model attains an AUC below 0.5 — worse than what is expected from random guessing. However, the 0.5 is just an expectation value, and the AUC of any given random classifier is likely to be found somewhere close to this number. Therefore, we can interpret the leftmost graph as evidence that the model couldn’t find <em>any</em> generalizable imaging features relevant for predicting treatment response during training. On the other hand, the model trained on the “leaky” set of slices attains a near-perfect performance, misclassifying only a handful of images.</p> <p>Although this experiment still does not conclusively prove that the slice-level split indeed happened in the paper, it does demonstrate that such high AUC values are indeed possible in this scenario — even when the underlying <em>intended</em> prediction task is extremely difficult, if not impossible.</p> <h1 id="wrapping-up">wrapping up</h1> <p>I now felt the case was strong enough to actually draft the letter to the editor. As a final touch, my other PI (<a href="https://aiforoncology.nl/" rel="external nofollow noopener" target="_blank">Jonas Teuwen</a>) suggested to ask some more senior people in the field to co-sign the letter. I approached several colleagues and collaborators, all of whom agreed that this matter deserved further attention, and all agreed to co-sign. I officially submitted the letter on April 10, 2024 — a little over half a year after I first posted the comment on PubPeer. It was quickly accepted and has now appeared online after a brief production process. To my knowledge, the authors have still not responded as of today.</p> <p>A minor disappointment was that publishing the letter with full Open Access would set me back $4390, which seemed somewhat excessive. My institution does have an Open Access agreement in place with SpringerNature, but apparently this does not extend to editorial letters. I therefore had to opt for the subscription-only publishing route. The upside is that this motivated me to write this post, since I felt that having the full story behind a paywall would partially defeat its purpose.</p> <p>I do feel that the story shouldn’t end with the publication of this letter. After all, my concern was that the original work would set an unreasonable benchmark for follow-up literature, and that won’t change in the current situation. Primarily, I hope that the authors will still take up the invitation to respond and clarify their methods. I don’t mind who turns out to be correct, but open discourse about these issues is the only way for science to proceed.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/concerns-jdim.bib"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Joren Brunekreef. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: June 10, 2024. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-NZXH5MQL6C"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NZXH5MQL6C");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>